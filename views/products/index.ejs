<!-- FIXED TEMPLATE V2 -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Liste des produits</h1>
  <a href="/products/create" class="btn btn-primary">Ajouter un produit</a>
</div>

<!-- Filtres -->
<div class="card mb-4">
  <div class="card-header bg-light">
    <h5 class="mb-0">Filtres</h5>
  </div>
  <div class="card-body">
    <form action="/products" method="GET" class="row g-3">
      <div class="col-md-4">
        <label for="search" class="form-label">Recherche</label>
        <input type="text" class="form-control" id="search" name="search" value="<%= filters?.search || '' %>" placeholder="Nom ou description...">
      </div>
      <div class="col-md-3">
        <label for="category" class="form-label">Catégorie</label>
        <select class="form-select" id="category" name="category">
          <option value="">Toutes les catégories</option>
          <% ['Électronique', 'Vêtements', 'Alimentation', 'Livres', 'Autres'].forEach(cat => { %>
            <option value="<%= cat %>" <%= (filters?.category === cat) ? 'selected' : '' %>><%= cat %></option>
          <% }) %>
        </select>
      </div>
      <div class="col-md-2">
        <label for="inStock" class="form-label">Disponibilité</label>
        <select class="form-select" id="inStock" name="inStock">
          <option value="">Tous</option>
          <option value="true" <%= (filters?.inStock === 'true') ? 'selected' : '' %>>En stock</option>
        </select>
      </div>
      <div class="col-md-1">
        <label for="minPrice" class="form-label">Prix min</label>
        <input type="number" class="form-control" id="minPrice" name="minPrice" value="<%= filters?.minPrice || '' %>">
      </div>
      <div class="col-md-1">
        <label for="maxPrice" class="form-label">Prix max</label>
        <input type="number" class="form-control" id="maxPrice" name="maxPrice" value="<%= filters?.maxPrice || '' %>">
      </div>
      <div class="col-md-1 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Filtrer</button>
      </div>
    </form>
  </div>
</div>

<% if (products.length === 0) { %>
  <div class="alert alert-info">Aucun produit disponible.</div>
<% } else { %>
  <div class="row row-cols-1 row-cols-md-3 g-4">
    <% products.forEach(product => { %>
      <div class="col">
        <div class="card h-100">
          <div class="card-header d-flex justify-content-between">
            <span class="badge <%= product.inStock ? 'bg-success' : 'bg-danger' %>">
              <%= product.inStock ? 'En stock' : 'Rupture de stock' %>
            </span>
            <span class="text-muted small"><%= product.category %></span>
          </div>
          <div class="card-body">
            <h5 class="card-title"><%= product.name %></h5>
            <h6 class="card-subtitle mb-2 text-muted"><%= product.price.toFixed(2) %> €</h6>
            <p class="card-text">
              <%= product.description ? (product.description.length > 100 ? product.description.substring(0, 100) + '...' : product.description) : 'Aucune description' %>
            </p>
            <% if (product.tags && product.tags.length > 0) { %>
              <div class="mb-2">
                <% product.tags.forEach(tag => { %>
                  <span class="badge bg-light text-dark border"><%= tag %></span>
                <% }) %>
              </div>
            <% } %>
          </div>
          <div class="card-footer bg-transparent border-top-0">
            <div class="btn-group w-100">
              <a href="/products/<%= product._id %>" class="btn btn-sm btn-outline-primary">Voir</a>
              <a href="/products/edit/<%= product._id %>" class="btn btn-sm btn-outline-warning">Modifier</a>
              <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal<%= product._id %>">Supprimer</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="deleteModal<%= product._id %>" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Confirmer la suppression</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              Êtes-vous sûr de vouloir supprimer le produit "<%= product.name %>" ?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
              <form action="/products/<%= product._id %>/delete" method="POST">
                <button type="submit" class="btn btn-danger">Supprimer</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
  <% if (pagination.totalPages > 1) { %>
    <nav class="mt-4">
      <ul class="pagination justify-content-center">
        <li class="page-item <%= pagination.page === 1 ? 'disabled' : '' %>">
          <a class="page-link" href="/products?page=<%= pagination.page - 1 %>&limit=<%= pagination.limit %><%= filters ? '&' + new URLSearchParams(filters).toString() : '' %>">Précédent</a>
        </li>
        <% for (let i = 1; i <= pagination.totalPages; i++) { %>
          <li class="page-item <%= pagination.page === i ? 'active' : '' %>">
            <a class="page-link" href="/products?page=<%= i %>&limit=<%= pagination.limit %><%= filters ? '&' + new URLSearchParams(filters).toString() : '' %>"><%= i %></a>
          </li>
        <% } %>
        <li class="page-item <%= pagination.page === pagination.totalPages ? 'disabled' : '' %>">
          <a class="page-link" href="/products?page=<%= pagination.page + 1 %>&limit=<%= pagination.limit %><%= filters ? '&' + new URLSearchParams(filters).toString() : '' %>">Suivant</a>
        </li>
      </ul>
    </nav>
  <% } %>
<% } %>
